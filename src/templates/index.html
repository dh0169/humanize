<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat API Debug Page</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        section { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
        button { margin-top: 10px; margin-right: 5px; }
        #messages { margin-top: 20px; }
        .message { margin-bottom: 10px; }
        .list { list-style-type: none; padding: 0; }
        .list li { margin-bottom: 5px; }
    </style>
</head>
<body>
    <h1>Humanize Chat API Debug Page</h1>

    <section id="register">
        <h2>Register</h2>
        <input type="text" id="username" placeholder="Enter username">
        <button onclick="register()">Register</button>
        <button onclick="logout()">Logout</button>
    </section>

    <section id="joinHost">
        <h2>Join or Host a Room</h2>
        <input type="text" id="roomName" placeholder="Enter room name">
        <button onclick="joinRoom()">Join Room</button>
        <button onclick="hostRoom()">Host Room</button>
        <button onclick="joinRandomRoom()">Join Random Room</button>
    </section>

    <section id="lobbySessions">
        <h2>Lobby Sessions</h2>
        <button onclick="listLobbySessions()">List Lobby Sessions</button>
        <h3>Pending Sessions</h3>
        <ul id="pendingSessionsList" class="list"></ul>
        <h3>Active Sessions</h3>
        <ul id="activeSessionsList" class="list"></ul>
    </section>

    <section id="lobbyUsers">
        <h2>Lobby Users</h2>
        <button onclick="listLobbyUsers()">List Lobby Users</button>
        <ul id="usersList" class="list"></ul>
    </section>

    <div id="messages"></div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        let currentUser = null;

        // Configure axios
        axios.defaults.withCredentials = true;
        axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';

        function showMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.textContent = message;
            messagesDiv.appendChild(messageElement);
        }

        async function register() {
            const username = document.getElementById('username').value;
            try {
                const response = await axios.post(`${API_URL}/register`, { username });
                if (response.data.did_succeed) {
                    currentUser = response.data.data.user;
                    showMessage(`Registered as: ${currentUser}`);
                } else {
                    showMessage(`Registration failed: ${response.data.message}`);
                }
            } catch (error) {
                showMessage(`Error: ${error.response?.data?.message || error.message}`);
            }
        }

        async function logout() {
            try {
                const response = await axios.get(`${API_URL}/logout`);
                showMessage(response.data.message);
                currentUser = null;
            } catch (error) {
                showMessage(`Error: ${error.response?.data?.message || error.message}`);
            }
        }

        async function joinRoom() {
            const room = document.getElementById('roomName').value;
            try {
                const response = await axios.post(`${API_URL}/lobby`, { type: 'join', room });
                showMessage(`Join room response: ${JSON.stringify(response.data)}`);
            } catch (error) {
                showMessage(`Error: ${error.response?.data?.message || error.message}`);
            }
        }

        async function hostRoom() {
            const room = document.getElementById('roomName').value;
            try {
                const response = await axios.post(`${API_URL}/lobby`, { type: 'host', room });
                showMessage(`Host room response: ${JSON.stringify(response.data)}`);
            } catch (error) {
                showMessage(`Error: ${error.response?.data?.message || error.message}`);
            }
        }

        async function joinRandomRoom() {
            try {
                const response = await axios.post(`${API_URL}/lobby`, { type: 'join', random: true });
                showMessage(`Join random room response: ${JSON.stringify(response.data)}`);
            } catch (error) {
                showMessage(`Error: ${error.response?.data?.message || error.message}`);
            }
        }

        async function listLobbySessions() {
            try {
                const response = await axios.get(`${API_URL}/lobby/sessions`);
                const pendingList = document.getElementById('pendingSessionsList');
                const activeList = document.getElementById('activeSessionsList');
                pendingList.innerHTML = '';
                activeList.innerHTML = '';

                if (response.data.pending_sessions) {
                    response.data.pending_sessions.forEach(session => {
                        const li = document.createElement('li');
                        li.textContent = JSON.stringify(session);
                        pendingList.appendChild(li);
                    });
                }

                if (response.data.active_sessions) {
                    response.data.active_sessions.forEach(session => {
                        const li = document.createElement('li');
                        li.textContent = JSON.stringify(session);
                        activeList.appendChild(li);
                    });
                }

                showMessage(response.data.message);
            } catch (error) {
                showMessage(`Error: ${error.response?.data?.message || error.message}`);
            }
        }

        async function listLobbyUsers() {
            try {
                const response = await axios.get(`${API_URL}/lobby/users`);
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';

                if (response.data.users) {
                    response.data.users.forEach(user => {
                        const li = document.createElement('li');
                        li.textContent = JSON.stringify(user);
                        usersList.appendChild(li);
                    });
                }

                showMessage(response.data.message);
            } catch (error) {
                showMessage(`Error: ${error.response?.data?.message || error.message}`);
            }
        }
    </script>
</body>
</html>